---
title: "envr_dist_quantiles.Rmd"
author: "Kiran Bajaj"
output: html_document
date: "2025-04-22"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Packages

```{r}

library(tidyverse)
library(readr)

```

### Load data

This is the standard deviation, 10th quantile, and 90th quantile for salinity and temperature all in one data frame. It includes the 8 environments-of-origin and the 2 environments-of-experiment.

```{r}
setwd("~/Desktop/GitHub/MVP-H2F-HatcheryField/src/envr_data")

envr_quants_raw <- read_csv("../../data/environment/quantiles_05232025.csv")[,-c(1, 9)]
```

### Data preparation
Make one version with field sites and one version without
```{r}

envr_quants_ordered <- envr_quants_raw %>% 
  arrange(factor(site_name, levels = c("W1-TX", "W2-LA", "W3-FL", "W4-VA", "S1-LOLA", "S2-DEBY", "W5-NH", "W6-ME", "LEW", "YRK"))) # reorder

#make version without field sites
envr_quants_filtered <- envr_quants_raw %>% 
  filter(!site_name %in% c("LEW", "YRK")) %>% # remove environments of experiment
  arrange(factor(site_name, levels = c("W1-TX", "W2-LA", "W3-FL", "W4-VA", "S1-LOLA", "S2-DEBY", "W5-NH", "W6-ME"))) # reorder

# save as csv
write.csv(envr_quants_filtered, "../../data/envr_of_origin/envr_quantiles_summary.csv")
          
```

### Run distance analysis - all sites

```{r}
# select columns that need to be scaled for distance analysis
envr_for_scaling_all <- envr_quants_ordered %>%
  select(salinity_quantile_10, salinity_quantile_90, temp_quantile_10, temp_quantile_90)

# scale
envr_scaled_all <- (scale(envr_for_scaling_all))

# calculate distances
envr_quants_mat_all <- as.matrix(dist(envr_scaled_all))

# add labels back
rownames(envr_quants_mat_all) <- c("W1-TX", "W2-LA", "W3-FL", "W4-VA", "S1-LOLA", "S2-DEBY", "W5-NH", "W6-ME", "LEW", "YRK")
colnames(envr_quants_mat_all) <- c("W1-TX", "W2-LA", "W3-FL", "W4-VA", "S1-LOLA", "S2-DEBY", "W5-NH", "W6-ME", "LEW", "YRK")

```

#### Data product: environmental distance matrix- all sites

Scaled, using quantiles and no standard deviations. 

```{r}

# save envr distance matrix as csv
write.csv(envr_quants_mat_all, "../../data/envr_of_origin/envr_quantiles_dist_all.csv")

View(envr_quants_mat_all)
```

### Run distance analysis - filtered sites

```{r}
# select columns that need to be scaled for distance analysis
envr_for_scaling <- envr_quants_filtered %>%
  select(salinity_quantile_10, salinity_quantile_90, temp_quantile_10, temp_quantile_90)

# scale
envr_scaled <- (scale(envr_for_scaling))

# calculate distances
envr_quants_mat <- as.matrix(dist(envr_scaled))

# add labels back
rownames(envr_quants_mat) <- c("W1-TX", "W2-LA", "W3-FL", "W4-VA", "S1-LOLA", "S2-DEBY", "W5-NH", "W6-ME")
colnames(envr_quants_mat) <- c("W1-TX", "W2-LA", "W3-FL", "W4-VA", "S1-LOLA", "S2-DEBY", "W5-NH", "W6-ME")

```

#### Data product: environmental distance matrix- filtered sites

Scaled, using quantiles and no standard deviations. 

```{r}

# save envr distance matrix as csv
saveRDS(envr_quants_mat, "../../data/envr_of_origin/envr_quantiles_dist.rds")

View(envr_quants_mat)
```
