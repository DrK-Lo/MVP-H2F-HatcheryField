---
title: "Survival_vs_EnvrDist"
author: "Nicole Mongillo"
date: "2025-08-20"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This file compares survival for each treatment group at each common garden site to environmental distance from their EOO to the common garden environment. We found that groups from EOOs with less extreme cold temperatures have higher survival in the field experiment. Therefore, we are testing the hypothesis that the southern sites (W1-TX, W2-LA, W3-FL) are driving the positive relationship between environmental distance and survival. 

## Load packages
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "~/MVP-H2F-HatcheryField")

# load libraries
library(tidyverse) # for data wrangling
library(stringr) # for splitting strings
library(lubridate) # for dates
library(ggplot2) # for plotting
library(car) # for avPlots(), Anova()
library(emmeans) # for signif testing
library(car)
library(multcompView)
```

## Read in data
```{r}
setwd("~/Desktop/GitHub/MVP-H2F-HatcheryField/src/parent_effects_H2F")

# read in data
surv_mod_ord_rename <- read.csv("../../data/performance_H2F/field_surv_all_times2025-07-24.csv")[, -1]

#environmental distance based on scaled envr quantiles
env_dist <- read.csv("../../data/envr_of_origin/envr_quantiles_dist_all.csv")
```

## Data preparation
### Clean data and create merged data frame
```{r}
#remove H1-HYBRIDMIX and H2-SEEDMIX from survival
surv_sub <- surv_mod_ord_rename %>% 
  filter(pop != "H1-HYBRIDMIX" & pop!= "H2-SEEDMIX")

#keep only columns for environmental distance to LEW and YRK, exclude rows where common garden sites are compared to themselves
env_dist_cg <- env_dist[1:8, c(1, 10:11)]
colnames(env_dist_cg) <- c("pop", "dist_LEW", "dist_YRK")

#find mean survival for each pop at each monitoring event at each cg site
surv_means <- aggregate(surv_mod_ord_rename$surv, by = list(surv_mod_ord_rename$pop, surv_mod_ord_rename$bag_site, surv_mod_ord_rename$t), FUN = mean)

colnames(surv_means) <- c("pop", "bag_site", "t", "mean_surv")

#merge surv and environmental distance data
surv_dist_means <- merge(surv_means, env_dist_cg, by = "pop")

surv_dist_means$t <- as.character(surv_dist_means$t)
```

##Plot
```{r}
L_surv_dist_all <- surv_dist_means %>% 
  filter(bag_site == "Lewisetta") %>% 
  ggplot(aes(x = dist_LEW, y = mean_surv, color = pop))+
    geom_point(aes(shape = t))+
    ggtitle("Survival vs Env. Distance from EOOs to Lewisetta")+
    xlab("Environmental Distance from EOOs to Lewisetta")+
    ylab("Survival")+
    theme_bw()

L_surv_dist_all

#plot York
Ysurv_dist_plot <- surv_dist_means %>% 
  filter(bag_site == "YorkRiver") %>% 
  ggplot(aes(x = dist_YRK, y = mean_surv, color = pop))+
    geom_point()+
    ggtitle("Survival vs Env. Distance from EOOs to York")+
    xlab("Environmental Distance from EOOs to York")+
    ylab("Survival")+
    theme_bw()
 
Ysurv_dist_plot
```

